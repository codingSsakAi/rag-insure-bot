{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë³´í—˜ ì¶”ì²œ ì‹œìŠ¤í…œ</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI","Noto Sans KR",Arial,sans-serif;margin:0;padding:0;
         background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center}
    .container{background:white;padding:50px;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.1);text-align:center;max-width:680px}
    h1{color:#2c3e50;margin-bottom:10px;font-size:2.2em}
    p.sub{color:#4a5a70;margin:0 0 18px}
    .btn{display:inline-block;padding:14px 24px;margin:8px;background:linear-gradient(135deg,#3498db,#2980b9);
         color:white;text-decoration:none;border-radius:999px;transition:.2s;font-weight:800}
    .btn:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(52,152,219,.25)}
    .btn.sec{background:linear-gradient(135deg,#27ae60,#2ecc71)}
    .btn.ter{background:linear-gradient(135deg,#8e44ad,#9b59b6)}
    .nav{margin-top:18px;display:flex;gap:10px;justify-content:center}
    .nav a, .nav button{padding:8px 16px;border-radius:999px;border:1px solid #e5e9f2;background:#eef2f7;color:#243043;
                        text-decoration:none;font-weight:700;cursor:pointer}
    .logout{background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;border-color:transparent}
  </style>

  <!-- 1) ê¸°ì¡´ í¬í„¸ CSS ì‹œë„ (0826-5/insurance_portal/static/insurance_portal/portal.css) -->
  <link id="portal-css" rel="stylesheet" href="{% static 'insurance_portal/portal.css' %}">
  <!-- 2) í´ë°±ìš©: ì™¸ë¶€ CSSê°€ 404ë©´ ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¯¸ë‹ˆ CSSë¥¼ ì£¼ì… -->
  <script>
    // ë¯¸ë‹ˆ CSS ë¬¸ìì—´ (ì™¸ë¶€ CSS 404ì¼ ë•Œë§Œ ì£¼ì…)
    window.__PORTAL_FALLBACK_INJECT_CSS__ = function(){
      if (document.getElementById('ip-fallback-style')) return;
      const css = `
:root{--ipz:1040;--ip-bg:#0b1220f2;--ip-panel:#0f172a;--ip-text:#dbeafe;--ip-muted:#94a3b8;--ip-border:#233150;}
#ip-fab{position:fixed;right:22px;bottom:22px;z-index:var(--ipz);width:56px;height:56px;border-radius:999px;border:0;cursor:pointer;
  background:linear-gradient(135deg,#2563eb,#0891b2);color:#fff;box-shadow:0 10px 24px rgba(0,0,0,.24);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700}
#ip-fab:hover{transform:translateY(-1px);box-shadow:0 14px 30px rgba(0,0,0,.28)}
#ip-overlay{position:fixed;inset:0;background:rgba(0,0,0,.36);z-index:calc(var(--ipz) - 1);opacity:0;visibility:hidden;transition:.2s ease}
#ip-overlay.open{opacity:1;visibility:visible}
#ip-panel{position:fixed;top:0;bottom:0;width:min(360px,86vw);z-index:var(--ipz);background:var(--ip-panel);color:var(--ip-text);
  box-shadow:0 20px 50px rgba(0,0,0,.4);transition:transform .26s ease;border-left:1px solid var(--ip-border)}
#ip-panel.right{right:0;transform:translateX(100%)} #ip-panel.left{left:0;transform:translateX(-100%)}
#ip-panel.open.right,#ip-panel.open.left{transform:translateX(0)}
#ip-head{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;border-bottom:1px solid var(--ip-border)}
#ip-title{font-weight:900;font-size:16px;letter-spacing:.5px}
#ip-close{background:transparent;color:var(--ip-muted);border:0;font-size:22px;cursor:pointer}
#ip-close:hover{color:#fff}
#ip-list{padding:10px 6px 18px;overflow:auto;height:calc(100% - 56px)}
.ip-item a{display:flex;align-items:center;gap:10px;padding:12px 14px;border-radius:12px;margin:6px 8px;color:var(--ip-text);text-decoration:none;
  border:1px solid transparent;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02))}
.ip-item a:hover{border-color:var(--ip-border);background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03))}
.ip-item .ip-sub{font-size:12px;color:var(--ip-muted)}
.ip-item .ip-icon{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;border-radius:8px;background:#0b1220}
      `;
      const s=document.createElement('style');
      s.id='ip-fallback-style'; s.textContent=css; document.head.appendChild(s);
    };
  </script>
</head>
<body>
  <div class="container">
    <h1>ğŸ¥ ë³´í—˜ ì¶”ì²œ ì‹œìŠ¤í…œ</h1>
    <p class="sub">AI ê¸°ë°˜ ë§ì¶¤í˜• ë³´í—˜ ìƒí’ˆ ì¶”ì²œ ë° ì•½ê´€ ê²€ìƒ‰ ì„œë¹„ìŠ¤</p>

    <!-- ê¸°ëŠ¥ ë²„íŠ¼ -->
    <div>
      <a class="btn ter" href="{% url 'insurance_app:glossary' %}">ğŸ“˜ ì•½ê´€ ìš©ì–´ ì‚¬ì „</a>
      <a class="btn" href="{% url 'insurance_app:insurance_recommendation' %}">ğŸ” AI ì•½ê´€ ê²€ìƒ‰</a>
      <a class="btn sec" href="{% url 'insurance_app:recommend_insurance' %}">ğŸ“Š ë³´í—˜ ì¶”ì²œ</a>
    </div>

    <!-- í˜‘ì˜ì„œ ë°”ë¡œê°€ê¸° -->
    <div style="margin-top:8px">
      <a class="btn sec" href="{% url 'accident_project:agreement_new' %}">âœï¸ í˜‘ì˜ì„œ ì‘ì„±</a>
      <a class="btn" href="{% url 'accident_project:mypage_agreements' %}">ğŸ“‚ ë‚´ í˜‘ì˜ì„œ</a>
    </div>

    <div class="nav">
      {% if user.is_authenticated %}
        <a href="{% url 'insurance_app:mypage' %}">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</a>
        <form action="{% url 'insurance_app:logout' %}" method="post" style="display:inline">
          {% csrf_token %}<button class="logout" type="submit">ë¡œê·¸ì•„ì›ƒ</button>
        </form>
      {% else %}
        <a href="{% url 'insurance_app:signup' %}">íšŒì›ê°€ì…</a>
        <a href="{% url 'insurance_app:login' %}">ë¡œê·¸ì¸</a>
      {% endif %}
    </div>
  </div>

  <!-- í¬í„¸ ë©”ë‰´ ì„¤ì • -->
  <script>
    window.PORTAL_MENU = {
      brand: 'ë³´í—˜ í¬í„¸',
      position: 'right',
      items: [
        { title: 'ğŸ  í™ˆ',           url: '{% url "home" %}' },
        { title: 'ğŸ¤– ì•½ê´€ ì±—ë´‡',     url: '{% url "insurance_recommendation" %}' },
        { title: 'ğŸ“Š ë³´í—˜ ì¶”ì²œ',     url: '{% url "recommend_insurance" %}' },
        { title: 'ğŸ“˜ ìš©ì–´ ì‚¬ì „',     url: '{% url "glossary" %}' },
        { title: 'ğŸ“ ìƒˆ í˜‘ì˜ì„œ',     url: '{% url "accident_project:agreement_new" %}' },
        { title: 'ğŸ“‚ ë‚´ í˜‘ì˜ì„œ',     url: '{% url "accident_project:mypage_agreements" %}' }
      ]
    };
  </script>

  <!-- 3) ê¸°ì¡´ í¬í„¸ JS ì‹œë„ -->
  <script id="portal-js" src="{% static 'insurance_portal/portal.js' %}" defer></script>

  <!-- 4) JS í´ë°±: ì™¸ë¶€ JS ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë¯¸ë‹ˆ í† ê¸€ JS ì£¼ì… -->
  <script>
    (function(){
      // ë¯¸ë‹ˆ JS (ì™¸ë¶€ portal.jsê°€ 404ì¼ ë•Œë§Œ ì‚¬ìš©)
      function injectMiniJS(){
        if (window.__PORTAL_MINI_INJECTED__) return;
        window.__PORTAL_MINI_INJECTED__ = true;

        // CSS í´ë°±ë„ ë³´ì¥
        if (typeof window.__PORTAL_FALLBACK_INJECT_CSS__ === 'function') {
          window.__PORTAL_FALLBACK_INJECT_CSS__();
        }

        const cfg = (window.PORTAL_MENU || {});
        const brand = cfg.brand || 'Insurance Portal';
        const pos   = (cfg.position === 'left') ? 'left' : 'right';
        const items = Array.isArray(cfg.items) ? cfg.items : [];

        function el(tag, attrs={}, children=[]){
          const e=document.createElement(tag);
          Object.entries(attrs||{}).forEach(([k,v])=>{
            if(k==='class') e.className=v;
            else if(k==='text') e.textContent=v;
            else e.setAttribute(k,v);
          });
          (children||[]).forEach(c=>e.appendChild(c));
          return e;
        }
        function build(){
          const overlay = el('div', { id:'ip-overlay','aria-hidden':'true' });
          const panel   = el('aside', { id:'ip-panel' }); panel.classList.add(pos);
          const head    = el('div',{ id:'ip-head' },[
            el('div',{ id:'ip-title', text:brand }),
            el('button',{ id:'ip-close', 'aria-label':'ë‹«ê¸°', title:'ë‹«ê¸°' },[ el('span',{ text:'Ã—' }) ])
          ]);
          const list = el('div',{ id:'ip-list' });
          items.forEach(it=>{
            if(!it||!it.title||!it.url) return;
            const a = el('a',{ href: it.url });
            a.innerHTML = `<span class="ip-icon">â‰¡</span><span><div style="font-weight:800">${it.title}</div>${it.desc?`<div class="ip-sub">${it.desc}</div>`:''}</span>`;
            list.appendChild(el('div',{ class:'ip-item' }, [a]));
          });
          panel.appendChild(head); panel.appendChild(list);
          const fab = el('button',{ id:'ip-fab','aria-label':'ë©”ë‰´ ì—´ê¸°',title:'ë©”ë‰´' },[ el('span',{ text:'â‰¡' }) ]);

          function open(){ overlay.classList.add('open'); panel.classList.add('open'); overlay.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
          function close(){ overlay.classList.remove('open'); panel.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
          fab.addEventListener('click', open);
          overlay.addEventListener('click', close);
          head.querySelector('#ip-close').addEventListener('click', close);
          document.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });

          document.body.appendChild(overlay);
          document.body.appendChild(panel);
          document.body.appendChild(fab);
        }
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', build); else build();
      }

      // ì™¸ë¶€ JS ë¡œë“œ ì‹¤íŒ¨ ê°ì§€
      const js = document.getElementById('portal-js');
      let loaded = false;
      js.addEventListener('load', ()=>{ loaded = true; });
      js.addEventListener('error', injectMiniJS);
      // ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ error ì´ë²¤íŠ¸ ì•ˆ ë‚˜ì˜¬ ë•Œë¥¼ ëŒ€ë¹„í•œ íƒ€ì„ì•„ì›ƒ
      setTimeout(()=>{ if(!loaded && !window.__PORTAL_MINI_INJECTED__) injectMiniJS(); }, 900);
    })();
  </script>
</body>
</html>
